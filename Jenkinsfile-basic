pipeline{
    agent any

    stages{
        stage ('Pull Code from GutHub'){
            steps{
                sh '''
                  ls -lah
                  mvn --version
                '''
            }
        }
        stage ('Package and Test Code'){
            steps{
                sh '''
                  mvn test
                  mvn package
                '''
            }
        }
        stage ('Build and Push Docker Images'){
            steps{
                script {
                    docker.withRegistry('https://registry.hub.docker.com/', 'bagrat92') {
                        def imageName = "bagrat92/java-maven-app:${BUILD_ID}"
                        def dockerfile = "."

                    // Build the Docker image
                        docker.build(imageName, "-f ${dockerfile} .")

                    // Push the Docker image to DockerHub
                        docker.withRegistry('', 'bagrat92') {
                        docker.image(imageName).push()
                        }
                    }
                }
            }
        }
    }
}